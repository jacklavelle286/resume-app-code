{
 "variables": {
   "source_ami": ""
 },
 "builders": [
   {
     "type": "amazon-ebs",
     "region": "us-east-1",
     "source_ami": "{{user `source_ami`}}",
     "instance_type": "t2.micro",
     "iam_instance_profile": "ssm",  
     "ami_name": "my-portfolio-ami-pipeline-image-{{timestamp}}",
     "communicator": "ssh",
     "ssh_interface": "session_manager"
   }
 ],
 "provisioners": [
   {
     "type": "shell",
     "inline": [
       "sudo yum install -y amazon-ssm-agent",  
       "sudo systemctl start amazon-ssm-agent",
       "sudo systemctl enable amazon-ssm-agent"
     ]
   },
   {
     "type": "shell",
     "inline": [
       "sudo yum update -y",
       "sudo yum install -y httpd",
       "sudo systemctl start httpd",
       "sudo systemctl enable httpd"
     ]
   },
   {
     "type": "file",
     "source": "{{template_dir}}/website-files/",
     "destination": "/var/www/html/"
   },
   {
     "type": "shell",
     "inline": [
       "sudo chown -R root:root /var/www/html",
       "sudo systemctl restart httpd"
     ]
   }
 ]
}
